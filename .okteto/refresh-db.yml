name: web-core-refresh-db

# Okteto Deploy-only manifest.
# Purpose: run dev-only maintenance tasks from Okteto UI (Catalog) without `okteto up`.
#
# This is intended to be deployed into namespace `web-synestra-io-dev`, but operates across namespaces:
# - `databases` (CNPG refresh job)
#
# Docs:
# - https://www.okteto.com/docs/1.39/self-hosted/manage/custom-resource-definitions/
# - https://www.okteto.com/docs/development/deploy/deploy-from-catalog/
deploy:
  # Refresh DB (dev from prod)
  - kubectl -n databases delete job refresh-synestra-io-dev-db-from-prod --ignore-not-found
  - kubectl apply -f deploy/jobs/db-refresh-synestra-io-dev-from-prod.yaml
  - kubectl -n databases wait --for=condition=complete job/refresh-synestra-io-dev-db-from-prod --timeout=60m
  - kubectl -n databases logs job/refresh-synestra-io-dev-db-from-prod
