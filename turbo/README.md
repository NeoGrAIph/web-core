# `turbo/` — инструменты Turborepo в `web-core`

Этот каталог — “служебная зона” Turborepo: всё, что относится к генераторам и вспомогательным инструментам, но **не является** кодом `apps/*` и `packages/*`.

Если нужно понять, “как устроен Turborepo в монорепе” — начинайте отсюда, а затем смотрите:
- конфиг пайплайна: `turbo.json`
- скрипты запуска: `package.json` в корне
- архитектурные правила/нюансы: `docs/architecture/tooling-turborepo.md`

## Как формируется пайплайн (коротко)

В `turbo.json` описаны задачи (tasks), их зависимости и кэш:
- `build` зависит от `^build` (сначала build зависимостей по графу), кэшируется по `outputs`;
- `lint`/`typecheck`/`test` тоже завязаны на `^<task>`, но обычно не имеют outputs;
- `dev` помечен `cache: false` и `persistent: true`.

`globalDependencies` включает `**/.env*` — это значит, что изменение env-файлов влияет на кэш (без хранения секретов в репозитории).

## Рекомендации по добавлению нового app/package

1) Добавьте workspace в `apps/*` или `packages/*` (pnpm workspaces уже настроены).
2) Внутри проекта определите скрипты:
   - минимум: `dev`, `build`, `typecheck`
   - желательно: `lint`, `test` (даже если тестов пока нет — можно явно писать `echo \"no tests\"`)
3) Если это Next.js app, следите чтобы `build` реально генерировал `.next/` (это важно для корректного кэширования `build` в `turbo.json`).

## `turbo prune` для контейнерных сборок

Для сборки образов отдельных deployments из монорепозитория используем `turbo prune --docker`.
В корне есть готовый пример:
- `pnpm prune:synestra-io` → `out/synestra-io/`

Если добавляете новый app — добавьте аналогичный `prune:<app>` скрипт в корневой `package.json`.

## Генераторы (`@turbo/gen`)

`turbo/generators/` — заготовка под генераторы (`pnpm gen`), чтобы:
- уменьшить копипаст при создании новых пакетов/компонентов;
- фиксировать стандарты структуры (имена файлов, тесты, экспорты).

Сейчас генераторы считаются WIP (см. `turbo/generators/README.md`).
